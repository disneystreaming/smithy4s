"use strict";(self.webpackChunksmithy4s=self.webpackChunksmithy4s||[]).push([[416],{3905:(e,n,t)=>{t.d(n,{Zo:()=>u,kt:()=>f});var r=t(7294);function o(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function a(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach((function(n){o(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,r,o=function(e,n){if(null==e)return{};var t,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)t=i[r],n.indexOf(t)>=0||(o[t]=e[t]);return o}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)t=i[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var s=r.createContext({}),p=function(e){var n=r.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):a(a({},n),e)),t},u=function(e){var n=p(e.components);return r.createElement(s.Provider,{value:n},e.children)},c="mdxType",d={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},m=r.forwardRef((function(e,n){var t=e.components,o=e.mdxType,i=e.originalType,s=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),c=p(t),m=o,f=c["".concat(s,".").concat(m)]||c[m]||d[m]||i;return t?r.createElement(f,a(a({ref:n},u),{},{components:t})):r.createElement(f,a({ref:n},u))}));function f(e,n){var t=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var i=t.length,a=new Array(i);a[0]=m;var l={};for(var s in n)hasOwnProperty.call(n,s)&&(l[s]=n[s]);l.originalType=e,l[c]="string"==typeof e?e:o,a[1]=l;for(var p=2;p<i;p++)a[p]=t[p];return r.createElement.apply(null,a)}return r.createElement.apply(null,t)}m.displayName="MDXCreateElement"},2314:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>s,contentTitle:()=>a,default:()=>d,frontMatter:()=>i,metadata:()=>l,toc:()=>p});var r=t(7462),o=(t(7294),t(3905));const i={sidebar_label:"Decoupled handlers",title:"Decoupled handlers"},a=void 0,l={unversionedId:"overview/handlers",id:"overview/handlers",title:"Decoupled handlers",description:"Although Smithy4s generates interfaces from smithy services, it is often desirable to split the implementation of individual methods into smaller composable components.",source:"@site/../docs/target/jvm-2.13/mdoc/01-overview/06-handlers.md",sourceDirName:"01-overview",slug:"/overview/handlers",permalink:"/smithy4s/docs/overview/handlers",draft:!1,editUrl:"https://github.com/disneystreaming/smithy4s/edit/main/modules/docs/src/01-overview/06-handlers.md",tags:[],version:"current",sidebarPosition:6,frontMatter:{sidebar_label:"Decoupled handlers",title:"Decoupled handlers"},sidebar:"tutorialSidebar",previous:{title:"Sharing specifications",permalink:"/smithy4s/docs/overview/sharing-specs"},next:{title:"Stubbed implementations",permalink:"/smithy4s/docs/overview/stubs"}},s={},p=[],u={toc:p},c="wrapper";function d(e){let{components:n,...t}=e;return(0,o.kt)(c,(0,r.Z)({},u,t,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"Although Smithy4s generates interfaces from smithy services, it is often desirable to split the implementation of individual methods into smaller composable components."),(0,o.kt)("p",null,"As of 0.18.19, Smithy4s provides functions to facilitate this usecase."),(0,o.kt)("p",null,"For instance, provided the following specification :"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-kotlin"},'$version: "2"\n\nnamespace smithy4s.example\n\nservice KVStore {\n  operations: [Get, Put, Delete],\n  errors: [UnauthorizedError]\n}\n\noperation Put {\n  input: KeyValue\n}\n\noperation Get {\n  input: Key,\n  output: Value,\n  errors: [KeyNotFoundError]\n}\n\noperation Delete {\n  input: Key,\n  errors: [KeyNotFoundError]\n}\n\nstructure Key {\n  @required\n  key: String\n}\n\nstructure KeyValue {\n  @required\n  key: String,\n  @required\n  value: String\n}\n\nstructure Value {\n  @required\n  value: String\n}\n\n@error("client")\nstructure UnauthorizedError {\n  @required\n  reason: String\n}\n\n@error("client")\nstructure KeyNotFoundError {\n  @required\n  message: String\n}\n')),(0,o.kt)("p",null,"it is possible to write the following code :"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-scala"},'import smithy4s.example.KVStoreOperation\nimport smithy4s.example._\nimport cats.effect._\n\ndef get(ref: Ref[IO, Map[String, String]]) = KVStoreOperation.Get.handler[IO] { input =>\n  ref.get.map(_.get(input.key)).flatMap {\n    case Some(value) => IO.pure(Value(value))\n    case None => IO.raiseError(KeyNotFoundError(s"Key not found: ${input.key}"))\n  }\n}\n\ndef put(ref: Ref[IO, Map[String, String]]) = KVStoreOperation.Put.handler[IO] { input =>\n  ref.update(_ + (input.key -> input.value))\n}\n\n// Handlers can also be created by inheriting from a class.\nclass delete(ref: Ref[IO, Map[String, String]]) extends KVStoreOperation.Delete.Handler[IO] {\n  def run(input: Key): IO[Unit] = ref.update(_ - input.key)\n}\n')),(0,o.kt)("p",null,"And compose the handlers as such :"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-scala"},"IO.ref(Map.empty[String, String]).map { ref =>\n  get(ref)\n    .or(put(ref))\n    .or(new delete(ref))\n    .asService(KVStore)\n    .throwing : KVStore[IO]\n}\n")),(0,o.kt)("p",null,"or as such :"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-scala"},"IO.ref(Map.empty[String, String]).map { ref =>\n  KVStore.fromHandlers(\n    get(ref),\n    put(ref),\n    new delete(ref)\n  ).throwing : KVStore[IO]\n}\n")),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},".throwing")," call indicates that calling un-implemented handlers will throw an exception. Other combinators are available to decide\nwhat behaviour should be applied when un-implemented handlers are called upon."))}d.isMDXComponent=!0}}]);